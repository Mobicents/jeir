<?xml version='1.0'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "EIR_Server_User_Guide.ent">
%BOOK_ENTITIES;
]>

<chapter id="setup">
	<title>Installation and Running</title>
	<section id="installing_and_using">
		<title>Installing</title>
		<para>A simple way to get started is to download and install binary. This will provide you with all the dependencies you need to get going. 
		You can obtain binary release from &THIS.RELEASE_BINARY_URL;
		</para>
		
		<section id="binary">
			<title>Binary</title>
			<para>The Mobicents jEIR Server is broken down into two modules.</para>
			<para>Binary release has the following layout:</para>
			
			<mediaobject id="binary_layout">
            	<imageobject>
                	<imagedata width="241px" align="center" fileref="images/binnar-structure.png" format="PNG" />
                </imageobject>
                <caption>
                	<para>&THIS.PLATFORM; &THIS.APPLICATION; binary layout.</para>
                </caption>
        	</mediaobject>
        	<note>
            	<title>Note</title>
                <para>X.Y.Z in above layout is the respective release version of binary.</para>
            </note>
		</section>
		
		<section id="dependencies">
			<title>Setup from source</title>
			<para>The &THIS.PLATFORM; &THIS.APPLICATION; is an open source project, instructions for building from source are part of the manual! Building from source means you can stay on top with the latest futures.</para>
			<para>&THIS.PLATFORM; &THIS.APPLICATION; works with JDK1.7 and above. You will also need to have the following tools installed. Minimum requirement version numbers provided.</para>
			
			<itemizedlist>
				<listitem>
					<para><literal>Git Client 1.6</literal> : Instructions for using GIT, including install, can be found at <ulink
									url="http://git-scm.com/book" /></para>
				</listitem>		
				<listitem>
					<para><literal>Maven 2.0.9</literal> : Instructions for using Maven, including install, can be found at <ulink
									url="http://maven.apache.org/" /></para>
				</listitem>	
				<listitem>
					<para><literal>Ant 1.7.0</literal> : Instructions for using Ant, including install, can be found at <ulink
									url="http://ant.apache.org" /></para>
				</listitem>	
			</itemizedlist>
			
			<section
			id="source_building">
			<title>Release Source Code Building</title>
			<procedure>
				<step>
					<title>Downloading the source code</title>
					
					<para>Use GIT to clone repository, the base URL is &THIS.TRUNK_SOURCE_CODE_URL;,
						then to checkout specific release version(tag) use <command>git checkout tag_name</command>, lets consider release-&THIS.VERSION;.
					</para>
					<programlisting>
[usr]$ git clone &THIS.TRUNK_SOURCE_CODE_URL;
[usr]$ cd jss7
[usr]$ git checkout release-&THIS.VERSION;
					</programlisting>
					<para>Browse the code online at <ulink url="&THIS.RELEASE_SOURCE_CODE_URL;" /> </para>
				</step>
				<step>
					<title>Building the source code</title>
					<para>Now that we have the source the next step is to build and install the source. 
					&THIS.PLATFORM; &THIS.APPLICATION; uses Maven 2 to build the system. There are three profiles. Default one builds only java source. The other two profiles 
					available "dahdilinux" and "dialogiclinux" additionaly compile native modules.</para>
					<note>
						<para>
							Native modules are supported only for linux OS for now.
						</para>
					</note>					
					<para>Use "dahdilinux" profile if linux server on which this code is built already has dahdi module installed. 
					Make sure you pass "include.zap" system property pointing to correct directory where dahdi is installed</para>
					<programlisting>
[usr]$ cd jss7
[usr]$ mvn install -Pdahdilinux -Dinclude.zap=/usr/include/dahdi
				    </programlisting>
				    
					<para>Use "dialogiclinux" profile if linux server on which this code is built already has dialogic module installed. 
					Make sure you pass "include.dialogic" and "include.dialogic.gctlib" system property pointing to correct directory where 
					dialogic libraries are installed. include.dialogic.gctlib points to directory where <literal>gctload</literal> is present (generally
					/opt/dpklnx for linux OS)</para>
					<programlisting>
[usr]$ cd jss7
[usr]$ mvn install -Pdialogclinux -Dinclude.dialogic=/opt/dpklnx/INC -Dinclude.dialogic.gctlib=/opt/dpklnx
				    </programlisting>	
				    
				   	<para>To build &THIS.PLATFORM; &THIS.APPLICATION; without building any native libraries use</para>
					<programlisting>
[usr]$ cd jss7
[usr]$ mvn install 
				    </programlisting>
					<note>
						<para>
							If you are using &THIS.PLATFORM; &THIS.APPLICATION; without any native dependencies, &THIS.PLATFORM; &THIS.APPLICATION; can run on any OS.
						</para>
					</note>
									    
							    
					<para>Use Ant to build the binary .</para>
					<programlisting>
[usr]$ cd jss7/release
[usr]$ ant
				    </programlisting>

				</step>
			</procedure>
		</section>
			
		</section>
	</section>
	
	<section id="installing_binary">
		<title>Installing &THIS.PLATFORM; &THIS.APPLICATION; Binary</title>
		<para>Copy the directory mobicents-eir-server and the file eir-service-du-X.Y.Z.jar to JBOSS_HOME/server/default/deploy</para>
	</section>
	
	<section id="installing_persistence_system">
		<title>Installing Apache Cassandra database</title>
		<para>Download the binary package <ulink url="http://cassandra.apache.org/download/" />. Unzip it and run ./cassandra -f</para>
		
		<section id="create_keyspace_cassandra">
			<title>Creating the keyspace at Apache Cassanra</title>
			<para>use $./cqlsh --cql3 to access the Cassandra CLI. Then type the following commands:</para>
			<programlisting>
CREATE KEYSPACE eirdb WITH strategy_class = 'org.apache.cassandra.locator.SimpleStrategy' AND strategy_options:replication_factor='1';
use eirdb;
CREATE TABLE blacklist(imei varchar, imsi varchar, PRIMARY KEY (imei));
			</programlisting>
		</section>
	</section>
	
</chapter>
